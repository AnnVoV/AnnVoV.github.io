<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
## Anuglar 应用的性能优化
参考文献：   
[Speeding up AngularJs apps with simple optimizations](https://www.binpress.com/tutorial/speeding-up-angular-js-with-simple-optimizations/135)

### 一次性绑定语法{{::value}}
AngularJs 1.3.0版本以后有了一个新的语法，可以使得数据的渲染只进行一次，并且不会受未来数据更新的影响。我们通过 {{::title}}实现。

这种情况下，Angular会去除这个DOM结构身上的$$watchers列表，这对性能表现来说意味着什么？这意味着可以更好地构建我们的应用。

### $scope.$apply() 对比 $scope.$digest()
$scope.$appy 是用来告诉Angulary一个数据模型的变化发生在了Anuglar的生命周期之外。（即与数据改变相关的内容绑定在了非Angular提供的默认事件上）

当$scope.$apply()被调用时，它会使整个应用进入$digest 循环，同时会导致开始执行$rootScope.$digest()，因为它触发的是从根节点开始的循环检查，一开始它的处理速度会很快，但是随着应用程序规模的增长，处理的时间会变得越来越长。

但是如果我们使用$scope.$digest,它是从当前的作用域$scope向下查询它的子节点，消耗的性能更少。

对于使用这种方式的一个警告是：如果你使用的是双向绑定并且希望更新到父级作用域的数据，父级的$scope 直到 $rootScope进行了完整的$digest循环才会得到修改。

### 避免直接使用ng-repeat,通过使用“track by”提高性能

[Improving ng-repeat Performance with "track by"](http://www.codelord.net/2014/04/15/improving-ng-repeat-performance-with-track-by/)

我们使用ng-repeat 的一般方式

```
	<ul class="tasks">
		<li ng-repeat="task in tasks" ng-class="{done:task.done}">
			{{task.id}} : {{task.title}}
		</li>
	</ul>
```

我们知道我们更新这整个ul最常用的方式是：

```
$scope.tasks = newTasksFromTheServer;   

```

这是一段非常简洁的代码，但是当我们进行数据更新时，它会移除所有已经存在的li元素，然后再重新创建他们，这样的代价是高昂的（例如：我们有很多歌li元素，并且每个li元素的模板是十分复杂的）。这意味着这一个过程包含了很多的DOM操作。

ngRepeat为每一项任务都添加了$$hashKey 属性用来追踪这每一项任务。如果你用新的任务对象去替换原先的任务对象，即使他们俩一模一样，因为新的对象并不存在$$hashKey 属性，所以ngRepeat并不知道他们代表着相同的元素内容。

<b>解决方案</b>
自Angular 1.2开始，新增加了一个track by 条款在ngRepeat语法中，它允许你为你的ngRepeat自定义key,而非使用由angualr自动生成的唯一IDs。

这意味着你可以使用这样的句法  `ng-repeat = "task in tasks track by task.id"`  因为无论原先的tasks和更新的tasks，ID都是一致的 ———— 这样ngRepeat会知道不需要创建新的DOM元素并且会复用他们。
下面我们来看个例子：

html:
```
	<div ng-controller="TasksCtrl">
    	<button ng-click="refresh()">Refresh Tasks</button>
    	<ul>
        <li ng-repeat="task in tasks track by task.title">{{::task.title}}{{::task.date}}</li>
    	</ul>
	</div>
```

js:

```
	 var app = angular.module('testApp', []);

    app
            .controller('TasksCtrl', ['$scope', function ($scope) {
                var date = new Date().toISOString();
                var newArr = [];
                $scope.tasks = [];

                for (var i = 0; i < 301; i++) {
                    $scope.tasks.push({
                        id: i,
                        title: 'Task' + i,
                        date: date
                    });
                }


                $scope.refresh = function(){
                    var testNewArr = [];
                    var date = new Date().toISOString();

                    for(var i=0; i<301;i++){
                        testNewArr.push({
                            id: i,
                            title: 'Task' + i,
                            date: date
                        });
                    }

                    $scope.tasks = testNewArr;
                }
            }]);

```

这里注意，我们在ng-repeat上面写了 track by task.title 意味着，如果 task.title 的值发生了改变我们的dom结构是会重排的，如果我们的task.title 相对于之前一次并没有发生改变，那么不会重排整个dom,你也会发现 date 没有更新。

可以尝一下不使用track by 语句而是直接使用 ng-repeat 的效果。你会发现，如果不使用track by 每一次更新，时间都发生了变化，但是如果我们使用了track by,我们可以看到如果track by后面根据的内容没有发生变化，数据是不会变化的，时间也没有刷新。



 









<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<h2 id="anuglar">Anuglar 应用的性能优化</h2>

<p>参考文献： <br>
<a href="https://www.binpress.com/tutorial/speeding-up-angular-js-with-simple-optimizations/135">Speeding up AngularJs apps with simple optimizations</a></p>

<h3 id="value">一次性绑定语法{{::value}}</h3>

<p>AngularJs 1.3.0版本以后有了一个新的语法，可以使得数据的渲染只进行一次，并且不会受未来数据更新的影响。我们通过 {{::title}}实现。</p>

<p>这种情况下，Angular会去除这个DOM结构身上的$$watchers列表，这对性能表现来说意味着什么？这意味着可以更好地构建我们的应用。</p>

<h3 id="dscopedapplydscopeddigest"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame"><nobr><span class="math" id="MathJax-Span-1" role="math" style="width: 3.164em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.577em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.899em 1000em 2.848em -999.998em); top: -2.482em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-4" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-5" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral-Italic;">e</span><span class="mo" id="MathJax-Span-8" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.486em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.892em; vertical-align: -0.331em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">scope.</script>apply() 对比 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame"><nobr><span class="math" id="MathJax-Span-9" role="math" style="width: 3.164em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.577em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.899em 1000em 2.848em -999.998em); top: -2.482em; left: 0.002em;"><span class="mrow" id="MathJax-Span-10"><span class="mi" id="MathJax-Span-11" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-12" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-13" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-14" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-15" style="font-family: STIXGeneral-Italic;">e</span><span class="mo" id="MathJax-Span-16" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.486em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.892em; vertical-align: -0.331em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">scope.</script>digest()</h3>

<p><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame"><nobr><span class="math" id="MathJax-Span-17" role="math" style="width: 3.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.933em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-18"><span class="mi" id="MathJax-Span-19" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-20" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-21" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-22" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-23" style="font-family: STIXGeneral-Italic;">e</span><span class="mo" id="MathJax-Span-24" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">scope.</script>appy 是用来告诉Angulary一个数据模型的变化发生在了Anuglar的生命周期之外。（即与数据改变相关的内容绑定在了非Angular提供的默认事件上）</p>

<p>当<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame"><nobr><span class="math" id="MathJax-Span-25" role="math" style="width: 3.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.933em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-26"><span class="mi" id="MathJax-Span-27" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-28" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-30" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral-Italic;">e</span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-4">scope.</script>apply()被调用时，它会使整个应用进入<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame"><nobr><span class="math" id="MathJax-Span-33" role="math" style="width: 15.043em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.198em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.578em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-34"><span class="mi" id="MathJax-Span-35" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-36" style="font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Italic;">g</span><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-39" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-40" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-41"><span class="mrow" id="MathJax-Span-42"><span class="mo" id="MathJax-Span-43"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">循</span></span></span></span><span class="texatom" id="MathJax-Span-44"><span class="mrow" id="MathJax-Span-45"><span class="mo" id="MathJax-Span-46"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">环</span></span></span></span><span class="texatom" id="MathJax-Span-47"><span class="mrow" id="MathJax-Span-48"><span class="mo" id="MathJax-Span-49"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">，</span></span></span></span><span class="texatom" id="MathJax-Span-50"><span class="mrow" id="MathJax-Span-51"><span class="mo" id="MathJax-Span-52"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">同</span></span></span></span><span class="texatom" id="MathJax-Span-53"><span class="mrow" id="MathJax-Span-54"><span class="mo" id="MathJax-Span-55"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">时</span></span></span></span><span class="texatom" id="MathJax-Span-56"><span class="mrow" id="MathJax-Span-57"><span class="mo" id="MathJax-Span-58"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">会</span></span></span></span><span class="texatom" id="MathJax-Span-59"><span class="mrow" id="MathJax-Span-60"><span class="mo" id="MathJax-Span-61"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">导</span></span></span></span><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mo" id="MathJax-Span-64"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">致</span></span></span></span><span class="texatom" id="MathJax-Span-65"><span class="mrow" id="MathJax-Span-66"><span class="mo" id="MathJax-Span-67"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">开</span></span></span></span><span class="texatom" id="MathJax-Span-68"><span class="mrow" id="MathJax-Span-69"><span class="mo" id="MathJax-Span-70"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">始</span></span></span></span><span class="texatom" id="MathJax-Span-71"><span class="mrow" id="MathJax-Span-72"><span class="mo" id="MathJax-Span-73"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">执</span></span></span></span><span class="texatom" id="MathJax-Span-74"><span class="mrow" id="MathJax-Span-75"><span class="mo" id="MathJax-Span-76"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">行</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.378em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">digest 循环，同时会导致开始执行</script>rootScope.$digest()，因为它触发的是从根节点开始的循环检查，一开始它的处理速度会很快，但是随着应用程序规模的增长，处理的时间会变得越来越长。</p>

<p>但是如果我们使用<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame"><nobr><span class="math" id="MathJax-Span-77" role="math" style="width: 3.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.543em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.933em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-78"><span class="mi" id="MathJax-Span-79" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-80" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-81" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-82" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-83" style="font-family: STIXGeneral-Italic;">e</span><span class="mo" id="MathJax-Span-84" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">scope.</script>digest,它是从当前的作用域$scope向下查询它的子节点，消耗的性能更少。</p>

<p>对于使用这种方式的一个警告是：如果你使用的是双向绑定并且希望更新到父级作用域的数据，父级的<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame"><nobr><span class="math" id="MathJax-Span-85" role="math" style="width: 4.83em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.915em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.578em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-86"><span class="mi" id="MathJax-Span-87" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-88" style="font-family: STIXGeneral-Italic;">c</span><span class="mi" id="MathJax-Span-89" style="font-family: STIXGeneral-Italic;">o</span><span class="mi" id="MathJax-Span-90" style="font-family: STIXGeneral-Italic;">p</span><span class="mi" id="MathJax-Span-91" style="font-family: STIXGeneral-Italic;">e</span><span class="texatom" id="MathJax-Span-92"><span class="mrow" id="MathJax-Span-93"><span class="mo" id="MathJax-Span-94"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">直</span></span></span></span><span class="texatom" id="MathJax-Span-95"><span class="mrow" id="MathJax-Span-96"><span class="mo" id="MathJax-Span-97"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">到</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.378em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-7">scope 直到 </script>rootScope进行了完整的$digest循环才会得到修改。</p>

<h3 id="ngrepeattrackby">避免直接使用ng-repeat,通过使用“track by”提高性能</h3>

<p><a href="http://www.codelord.net/2014/04/15/improving-ng-repeat-performance-with-track-by/">Improving ng-repeat Performance with "track by"</a></p>

<p>我们使用ng-repeat 的一般方式</p>

<pre><code>    &lt;ul class="tasks"&gt;
        &lt;li ng-repeat="task in tasks" ng-class="{done:task.done}"&gt;
            {{task.id}} : {{task.title}}
        &lt;/li&gt;
    &lt;/ul&gt;
</code></pre>

<p>我们知道我们更新这整个ul最常用的方式是：</p>

<pre><code>$scope.tasks = newTasksFromTheServer;   
</code></pre>

<p>这是一段非常简洁的代码，但是当我们进行数据更新时，它会移除所有已经存在的li元素，然后再重新创建他们，这样的代价是高昂的（例如：我们有很多歌li元素，并且每个li元素的模板是十分复杂的）。这意味着这一个过程包含了很多的DOM操作。</p>

<p>ngRepeat为每一项任务都添加了<span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-8-Frame"><nobr><span class="math" id="MathJax-Span-98" role="math" style="width: 58.133em; display: inline-block;"><span style="display: inline-block; position: relative; width: 47.259em; height: 0px; font-size: 123%;"><span style="position: absolute; clip: rect(1.578em 1000em 2.899em -999.997em); top: -2.538em; left: 0.003em;"><span class="mrow" id="MathJax-Span-99"><span class="mi" id="MathJax-Span-100" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-101" style="font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-102" style="font-family: STIXGeneral-Italic;">s</span><span class="mi" id="MathJax-Span-103" style="font-family: STIXGeneral-Italic;">h</span><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span class="mi" id="MathJax-Span-105" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-106" style="font-family: STIXGeneral-Italic;">y</span><span class="texatom" id="MathJax-Span-107"><span class="mrow" id="MathJax-Span-108"><span class="mo" id="MathJax-Span-109"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">属</span></span></span></span><span class="texatom" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mo" id="MathJax-Span-112"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">性</span></span></span></span><span class="texatom" id="MathJax-Span-113"><span class="mrow" id="MathJax-Span-114"><span class="mo" id="MathJax-Span-115"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">用</span></span></span></span><span class="texatom" id="MathJax-Span-116"><span class="mrow" id="MathJax-Span-117"><span class="mo" id="MathJax-Span-118"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">来</span></span></span></span><span class="texatom" id="MathJax-Span-119"><span class="mrow" id="MathJax-Span-120"><span class="mo" id="MathJax-Span-121"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">追</span></span></span></span><span class="texatom" id="MathJax-Span-122"><span class="mrow" id="MathJax-Span-123"><span class="mo" id="MathJax-Span-124"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">踪</span></span></span></span><span class="texatom" id="MathJax-Span-125"><span class="mrow" id="MathJax-Span-126"><span class="mo" id="MathJax-Span-127"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">这</span></span></span></span><span class="texatom" id="MathJax-Span-128"><span class="mrow" id="MathJax-Span-129"><span class="mo" id="MathJax-Span-130"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">每</span></span></span></span><span class="texatom" id="MathJax-Span-131"><span class="mrow" id="MathJax-Span-132"><span class="mo" id="MathJax-Span-133"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">一</span></span></span></span><span class="texatom" id="MathJax-Span-134"><span class="mrow" id="MathJax-Span-135"><span class="mo" id="MathJax-Span-136"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">项</span></span></span></span><span class="texatom" id="MathJax-Span-137"><span class="mrow" id="MathJax-Span-138"><span class="mo" id="MathJax-Span-139"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">任</span></span></span></span><span class="texatom" id="MathJax-Span-140"><span class="mrow" id="MathJax-Span-141"><span class="mo" id="MathJax-Span-142"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">务</span></span></span></span><span class="texatom" id="MathJax-Span-143"><span class="mrow" id="MathJax-Span-144"><span class="mo" id="MathJax-Span-145"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">。</span></span></span></span><span class="texatom" id="MathJax-Span-146"><span class="mrow" id="MathJax-Span-147"><span class="mo" id="MathJax-Span-148"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">如</span></span></span></span><span class="texatom" id="MathJax-Span-149"><span class="mrow" id="MathJax-Span-150"><span class="mo" id="MathJax-Span-151"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">果</span></span></span></span><span class="texatom" id="MathJax-Span-152"><span class="mrow" id="MathJax-Span-153"><span class="mo" id="MathJax-Span-154"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">你</span></span></span></span><span class="texatom" id="MathJax-Span-155"><span class="mrow" id="MathJax-Span-156"><span class="mo" id="MathJax-Span-157"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">用</span></span></span></span><span class="texatom" id="MathJax-Span-158"><span class="mrow" id="MathJax-Span-159"><span class="mo" id="MathJax-Span-160"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">新</span></span></span></span><span class="texatom" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="mo" id="MathJax-Span-163"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-164"><span class="mrow" id="MathJax-Span-165"><span class="mo" id="MathJax-Span-166"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">任</span></span></span></span><span class="texatom" id="MathJax-Span-167"><span class="mrow" id="MathJax-Span-168"><span class="mo" id="MathJax-Span-169"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">务</span></span></span></span><span class="texatom" id="MathJax-Span-170"><span class="mrow" id="MathJax-Span-171"><span class="mo" id="MathJax-Span-172"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">对</span></span></span></span><span class="texatom" id="MathJax-Span-173"><span class="mrow" id="MathJax-Span-174"><span class="mo" id="MathJax-Span-175"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">象</span></span></span></span><span class="texatom" id="MathJax-Span-176"><span class="mrow" id="MathJax-Span-177"><span class="mo" id="MathJax-Span-178"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">去</span></span></span></span><span class="texatom" id="MathJax-Span-179"><span class="mrow" id="MathJax-Span-180"><span class="mo" id="MathJax-Span-181"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">替</span></span></span></span><span class="texatom" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mo" id="MathJax-Span-184"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">换</span></span></span></span><span class="texatom" id="MathJax-Span-185"><span class="mrow" id="MathJax-Span-186"><span class="mo" id="MathJax-Span-187"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">原</span></span></span></span><span class="texatom" id="MathJax-Span-188"><span class="mrow" id="MathJax-Span-189"><span class="mo" id="MathJax-Span-190"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">先</span></span></span></span><span class="texatom" id="MathJax-Span-191"><span class="mrow" id="MathJax-Span-192"><span class="mo" id="MathJax-Span-193"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-194"><span class="mrow" id="MathJax-Span-195"><span class="mo" id="MathJax-Span-196"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">任</span></span></span></span><span class="texatom" id="MathJax-Span-197"><span class="mrow" id="MathJax-Span-198"><span class="mo" id="MathJax-Span-199"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">务</span></span></span></span><span class="texatom" id="MathJax-Span-200"><span class="mrow" id="MathJax-Span-201"><span class="mo" id="MathJax-Span-202"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">对</span></span></span></span><span class="texatom" id="MathJax-Span-203"><span class="mrow" id="MathJax-Span-204"><span class="mo" id="MathJax-Span-205"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">象</span></span></span></span><span class="texatom" id="MathJax-Span-206"><span class="mrow" id="MathJax-Span-207"><span class="mo" id="MathJax-Span-208"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">，</span></span></span></span><span class="texatom" id="MathJax-Span-209"><span class="mrow" id="MathJax-Span-210"><span class="mo" id="MathJax-Span-211"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">即</span></span></span></span><span class="texatom" id="MathJax-Span-212"><span class="mrow" id="MathJax-Span-213"><span class="mo" id="MathJax-Span-214"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">使</span></span></span></span><span class="texatom" id="MathJax-Span-215"><span class="mrow" id="MathJax-Span-216"><span class="mo" id="MathJax-Span-217"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">他</span></span></span></span><span class="texatom" id="MathJax-Span-218"><span class="mrow" id="MathJax-Span-219"><span class="mo" id="MathJax-Span-220"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">们</span></span></span></span><span class="texatom" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="mo" id="MathJax-Span-223"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">俩</span></span></span></span><span class="texatom" id="MathJax-Span-224"><span class="mrow" id="MathJax-Span-225"><span class="mo" id="MathJax-Span-226"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">一</span></span></span></span><span class="texatom" id="MathJax-Span-227"><span class="mrow" id="MathJax-Span-228"><span class="mo" id="MathJax-Span-229"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">模</span></span></span></span><span class="texatom" id="MathJax-Span-230"><span class="mrow" id="MathJax-Span-231"><span class="mo" id="MathJax-Span-232"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">一</span></span></span></span><span class="texatom" id="MathJax-Span-233"><span class="mrow" id="MathJax-Span-234"><span class="mo" id="MathJax-Span-235"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">样</span></span></span></span><span class="texatom" id="MathJax-Span-236"><span class="mrow" id="MathJax-Span-237"><span class="mo" id="MathJax-Span-238"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">，</span></span></span></span><span class="texatom" id="MathJax-Span-239"><span class="mrow" id="MathJax-Span-240"><span class="mo" id="MathJax-Span-241"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">因</span></span></span></span><span class="texatom" id="MathJax-Span-242"><span class="mrow" id="MathJax-Span-243"><span class="mo" id="MathJax-Span-244"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">为</span></span></span></span><span class="texatom" id="MathJax-Span-245"><span class="mrow" id="MathJax-Span-246"><span class="mo" id="MathJax-Span-247"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">新</span></span></span></span><span class="texatom" id="MathJax-Span-248"><span class="mrow" id="MathJax-Span-249"><span class="mo" id="MathJax-Span-250"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-251"><span class="mrow" id="MathJax-Span-252"><span class="mo" id="MathJax-Span-253"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">对</span></span></span></span><span class="texatom" id="MathJax-Span-254"><span class="mrow" id="MathJax-Span-255"><span class="mo" id="MathJax-Span-256"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">象</span></span></span></span><span class="texatom" id="MathJax-Span-257"><span class="mrow" id="MathJax-Span-258"><span class="mo" id="MathJax-Span-259"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">并</span></span></span></span><span class="texatom" id="MathJax-Span-260"><span class="mrow" id="MathJax-Span-261"><span class="mo" id="MathJax-Span-262"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">不</span></span></span></span><span class="texatom" id="MathJax-Span-263"><span class="mrow" id="MathJax-Span-264"><span class="mo" id="MathJax-Span-265"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">存</span></span></span></span><span class="texatom" id="MathJax-Span-266"><span class="mrow" id="MathJax-Span-267"><span class="mo" id="MathJax-Span-268"><span style="font-family: STIXGeneral, 'Arial Unicode MS', serif; font-size: 81%; font-style: normal; font-weight: normal;">在</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.543em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.378em; vertical-align: -0.309em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-8">hashKey 属性用来追踪这每一项任务。如果你用新的任务对象去替换原先的任务对象，即使他们俩一模一样，因为新的对象并不存在</script>hashKey 属性，所以ngRepeat并不知道他们代表着相同的元素内容。</p>

<p><b>解决方案</b>
自Angular 1.2开始，新增加了一个track by 条款在ngRepeat语法中，它允许你为你的ngRepeat自定义key,而非使用由angualr自动生成的唯一IDs。</p>

<p>这意味着你可以使用这样的句法  <code>ng-repeat = "task in tasks track by task.id"</code>  因为无论原先的tasks和更新的tasks，ID都是一致的 ———— 这样ngRepeat会知道不需要创建新的DOM元素并且会复用他们。
下面我们来看个例子：</p>

<p>html:</p>

<pre><code>    &lt;div ng-controller="TasksCtrl"&gt;
        &lt;button ng-click="refresh()"&gt;Refresh Tasks&lt;/button&gt;
        &lt;ul&gt;
        &lt;li ng-repeat="task in tasks track by task.title"&gt;{{::task.title}}{{::task.date}}&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
</code></pre>

<p>js:</p>

<pre><code>     var app = angular.module('testApp', []);

    app
            .controller('TasksCtrl', ['$scope', function ($scope) {
                var date = new Date().toISOString();
                var newArr = [];
                $scope.tasks = [];

                for (var i = 0; i &lt; 301; i++) {
                    $scope.tasks.push({
                        id: i,
                        title: 'Task' + i,
                        date: date
                    });
                }


                $scope.refresh = function(){
                    var testNewArr = [];
                    var date = new Date().toISOString();

                    for(var i=0; i&lt;301;i++){
                        testNewArr.push({
                            id: i,
                            title: 'Task' + i,
                            date: date
                        });
                    }

                    $scope.tasks = testNewArr;
                }
            }]);
</code></pre>

<p>这里注意，我们在ng-repeat上面写了 track by task.title 意味着，如果 task.title 的值发生了改变我们的dom结构是会重排的，如果我们的task.title 相对于之前一次并没有发生改变，那么不会重排整个dom,你也会发现 date 没有更新。</p>

<p>可以尝一下不使用track by 语句而是直接使用 ng-repeat 的效果。你会发现，如果不使用track by 每一次更新，时间都发生了变化，但是如果我们使用了track by,我们可以看到如果track by后面根据的内容没有发生变化，数据是不会变化的，时间也没有刷新。</p>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "angualrBetter.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    /*MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});*/
</script>
</body>
</html>
